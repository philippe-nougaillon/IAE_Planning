<div class="page-header">
  <div class="btn-group pull-right">
    <% if current_user.admin? %>
      <%= link_to edit_intervenant_path(@intervenant), class: 'btn btn-primary' do %>
        <span class="glyphicon glyphicon-pencil"></span>
        Modifier
      <% end %>

      <a href="#audit" data-toggle="collapse" class='btn btn-default'>
        <span class="glyphicon glyphicon-search"></span>
        Audit
      </a>

      <%= link_to intervenants_path, class: 'btn btn-default' do %>
        <span class="glyphicon glyphicon-list-alt"></span>
        Retour
      <% end %>
    <% end %>
  </div>
  <br><br>  
</div>


<div class="row">
  <div class="col-sm-3">
    <h1 style="font-size: 160px" class="glyphicon glyphicon-user"></h1>
  </div>  

  <div class="col-sm-3">
    <h2>
      <small>Nom</small><br>
      <%= @intervenant.nom %>
    </h2>
    <br>
    <h3>
      <small>Mobile</small><br>
      <%= @intervenant.téléphone_mobile %>
    </h3>
  </div>

  <div class="col-sm-6">
    <h2>
      <small>Prénom</small><br>
      <%= @intervenant.prenom %>
    </h2>
    <br> 
    <h3>
      <small>Courriel</small><br>
      <%= mail_to @intervenant.email %>
    </h3>
  </div>
</div>

<div class="row">
  <div class="col-sm-12">
    <h3>
      <small>Titre</small><br>
      <%= @intervenant.titre1 %>
      <%= @intervenant.titre2 %>
    </h3>

    <h3>
      <small>Statut</small><br>
      <%= @intervenant.try(:status).try(:humanize) %>
    </h3>
  </div>
</div>

<% if @formations.any? %>
  <div class="page-header"> 
    <h3>
      <small>
        <%= "Formation".pluralize(@formations.count) %>
        <%= "dispensée".pluralize(@formations.count) %>
      </small>
    </h3>
  </div>

  <% @formations.each_with_index do |formation, index| %>
    <%= link_to formation.nom, 
                cours_path(formation_id: formation, 
                            intervenant_id: @intervenant, 
                            intervenant: @intervenant.nom_prenom,
                            filter: 'all') %>
    <%= '|' if index != @formations.size - 1 %>
  <% end %>
<% end %>

<% if @intervenant.responsabilites.any? %>
  <div class="page-header"> 
    <h3>
      <small>Responsabilités</small>
    </h3>
  </div> 

  <ul>
    <% @intervenant.responsabilites.each do |r| %>
      <div class="row">
        <li>
          <div class="col-sm-1">
            <%= l r.debut %>
          </div>  
          <div class="col-sm-1">
            <%= l r.fin %>
          </div>  
          <div class="col-sm-2">
            <%= link_to(r.formation.nom, r.formation) if r.formation %>
          </div>  
          <div class="col-sm-2">
            <%= r.titre %>
          </div>  
          <div class="col-sm-1">
            <%= r.heures %>h
          </div>
        </li> 
      </div>
    <% end %>
  </ul>
<% end %>

<% if @intervenant.vacations.any? %>
  <div class="page-header"> 
    <h3>
      <small>Vacations</small>
    </h3>
  </div>

  <ul>
    <% @intervenant.vacations.each do |vacation| %>
      <div class="row">
        <li>
          <div class="col-sm-4">
            <%= vacation.formation.nom %>
          </div>  
          <div class="col-sm-2">
            <%= vacation.titre %>
          </div>
          <div class="col-sm-1">
            <%= vacation.forfaithtd %>h
          </div>
        </li> 
      </div>
    <% end %>
  </ul>
<% end %>

<div id="audit" class="collapse">
  <% if current_user.admin? %>
    <% if @intervenant.audits.any? %>
      <h3><small>Audit des modifications</small></h3>
      <table class="table table-condensed">
        <% @intervenant.audits.includes(:user).reverse.each do |audit| %>
          <tr>
            <td><%= l(audit.created_at, format: :short) %></td>
            <td><%= audit.user.email if audit.user %></td>
            <td><%= audit.action %></td>
            <td><%= sanitize audit.pretty_changes %></td>
          </tr>  
        <% end %>
      </table>
    <% end %>
  <% end %>
</div>
