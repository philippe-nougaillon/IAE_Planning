<div class="page-header">
  <% if current_user.try(:admin?) %>	
	  <%= link_to users_path, class: 'btn btn-default' do %>
	    <span class="glyphicon glyphicon-list-alt"></span>
	    Retour
	  <% end %>

		<a href="#audit" data-toggle="collapse" class='btn btn-default'>
      <span class="glyphicon glyphicon-search"></span>
      Audit
    </a>

	  <%= link_to edit_user_path(@user), class: 'btn btn-primary' do %>
	    <span class="glyphicon glyphicon-pencil"></span>
	    Modifier
	  <% end %>
  <% end %>	  
  <h1><%= @user.email %></h1>
</div>

<p>
	<strong>Nom:</strong>
	<%= @user.nom %>
</p>
<p>
	<strong>Prénom:</strong>
	<%= @user.prénom %>
</p>
<p>
	<strong>Mobile:</strong>
	<%= @user.mobile %>
</p>
<p>
	<strong>Peut réserver une salle ?:</strong> 
	<%= @user.reserver? ? "Oui" : "Non" %>
</p>
<p>
	<strong>Peut administrer l'application ?:</strong> 
	<%= @user.admin? ? "Oui" : "Non" %>
</p>
<br>

<p>
	Compte créé le: 
	le <%= l(@user.created_at) %> 
	| Il y a <%= time_ago_in_words(@user.created_at) %>
</p>

<% unless @user.sign_in_count.zero? %>
	<p>
		Connexion actuelle: 
		le <%= l(@user.current_sign_in_at) %> 
		| Il y a <%= time_ago_in_words(@user.current_sign_in_at) %>
	</p>
	<p>
		Dernière connexion: 
		le <%= l(@user.last_sign_in_at) %> 
		| Il y a <%= time_ago_in_words(@user.last_sign_in_at) %>
	</p>
	<p>
		Nbr connexions: <%= @user.sign_in_count %> 
	</p>
<% end %>
<br>

<div id="audit" class="collapse">
	<% if current_user.admin? %>
		<% if Audited.audit_class.any? %>
			<h3>Audit des modifications</h3>
			<table class="table table-condensed table-striped">
				<thead>
					<th>ID</th>
					<th style="width:100px">Date</th>
					<th>Table</th>
					<th>Action</th>
					<th>Changes</th>
				</thead>
				<% @audits.each do |audit| %>
					<tr>
						<td><%= audit.id %></td>
						<td><%= l(audit.created_at, format: :short) %></td>
						<td><%= audit.auditable_type %></td>
						<td><%= audit.action %></td>
						<td>
							<% begin %>
							<%= audit.try(:audited_changes) %>
							<% rescue %>
								???
							<% end %>
						</td>
					</tr>  
				<% end %>
			</table>
			<div class="page_info">
					<%= page_entries_info  @audits %>
				</div>

				<%= will_paginate @audits, renderer: BootstrapPagination::Rails %>
		<% end %>
	<% end %>
</div>