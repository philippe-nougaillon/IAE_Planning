<h1>Liste des salles</h1>

<div class='container-fluid'>
  <div class='row'>

    <%= form_tag request.path, method: :get do %>

      <div class="form-group">

        <div class="row">
          <div class="col-sm-3">
            <%= label_tag "Nom" %>    
            <%= text_field_tag :nom, params[:nom], include_blank:true, onchange:'this.form.submit()', class:"form-control" %>
          </div>

          <div class="col-sm-4">
            <%= label_tag "Date" %>    
            <div class="input-group">
              <%= text_field_tag :date, params[:date], type:'date', onchange:'this.form.submit()', class:"form-control" %>
              <span class="input-group-btn">
                <%= submit_tag 'Rechercher', class:"btn btn-primary" %>
                <%= link_to 'Ajouter', new_salle_path, class:"btn btn-success" %>
              </span>
            </div>
          </div>

          <% unless params[:date].blank? %>
            <div class="col-sm-2">
              <%= label_tag :libre, "Salles libres ?" %>
              <br>    
              <%= check_box_tag :libre, 1, params[:libre], 
                    onchange:'this.form.submit()', class:"form-control" %>
            </div>
          <% end %>

        </div>
      </div>  
    <% end %>
  </div>
  <div class='row'>
    <br>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Places</th>
        <th>Cours</th>
        <th colspan="2"></th>
      </tr>
    </thead>

    <tbody>
      <% @salles.each do |salle| %>
        <% if @date %>
          <% @cours = Cour.where("salle_id = ? AND cours.debut BETWEEN DATE(?) AND DATE(?)", salle.id, @date, @date + 1.day) %>
        <% else %>
          <% @cours = salle.cours %>
        <% end %>

        <tr>
          <td><%= salle.nom %></td>
          <td><%= salle.places %></td>
          <td><%= link_to @cours.count, cours_path(date:@date, salle_id:salle.id) %></td>
          <td>
            <%= link_to edit_intervenant_path(salle), class: "btn btn-default" do %>
              <i class="glyphicon glyphicon-pencil"></i>
            <% end %>
            <% unless salle.cours.any? %>
              <%= link_to(salle, method: :delete, data:{confirm: 'Confirmez-vous ?'}, class: "btn btn-default") do %>
                <i class="glyphicon glyphicon-remove"></i>
              <% end %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
