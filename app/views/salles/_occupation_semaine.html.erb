<div class="table-responsive">
  <table class="table table-hover table-striped">
    <thead>
      <tr>
        <th>Salle</th>
        <th>Places</th>
        <% (@date..(@date + 6.day)).each do |d| %>
          <th>
            <%= l(d, format: :day).humanize %>
            <%= d.day %>
           </th>
        <% end %> 
      </tr>
    </thead>
    <tfoot>
      <tr>
        <% 20.times do %><th /><% end %>
      </tr>
    </tfoot>

    <tbody>
      <% @salles.each do |salle| %>
        <% @cours = Cour.where(etat: Cour.etats.values_at(:confirmé, :réalisé)) %>
        <% @cours = @cours.where("salle_id = ? AND cours.debut BETWEEN DATE(?) AND DATE(?)", salle.id, @date, @date + 6.day).order(:debut) %>

        <tr>
          <td><b><%= salle.nom %></b></td>
          <td><%= salle.places %></td>
          <% (@date..(@date + 6.day)).each do |d| %>
            <% cours = @cours.where("cours.debut BETWEEN DATE(?) AND DATE(?)", d, d + 1.day) %>
            <td>
                <% color = cours.where("debut < ?", Time.parse(d.to_s + " 13:00")).any? ? 'red' : 'lightgreen' %>
                <span style="background-color:<%= color %>;padding-left: 15px;"></span>

                <% color = cours.where("debut >= ? AND debut <= ?", Time.parse(d.to_s + " 13:00"), Time.parse(d.to_s + " 18:00")).any? ? 'red' : 'lightgreen' %>
                <span style="background-color:<%= color %>;padding-left: 15px;"></span>

                <% color = cours.where("debut >= ?", Time.parse(d.to_s + " 18:00")).any? ? 'red' : 'lightgreen' %>
                <span style="background-color:<%= color %>;padding-left: 15px;"></span>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
