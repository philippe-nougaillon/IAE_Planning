<div class="row">
    <div class="col-md-12">
        <%= calendar partial: 'simple_calendar/week_rooms_calendar', 
                events: @cours.where(salle_id:nil), salle_id:0, number_of_days:6 do |date, meetings| %>
          <% meetings.each do |meeting| %>
              <span class="label <%= meeting.style %>"><%= meeting.etat.humanize %></span><br>
              <b><%= l(meeting.debut, format: :heures_min) %></b>  
              - <%= l(meeting.fin, format: :heures_min) %>
              <br>
              <% if meeting.formation.abrg %>
                <% if meeting.salle_id == nil %>
                  <%= link_to meeting.formation.abrg, cours_path(start_date:meeting.debut, formation:meeting.formation.nom, view:'list'), title:meeting.nom %>
                <% else %>                 
                  <%= link_to meeting.formation.abrg, edit_cour_path(meeting, from:'planning_salles'), title:meeting.nom %>
                <% end %>
              <% else %>
                <%= link_to meeting.formation.nom, meeting %>
              <% end %>
          <% end %>
        <% end %>
    </div>
</div>
  
<div class="row">
    <div class="col-md-12">
      <% bloc = 'A' %> 
      <% Salle.all.each do |salle_id| %>
        <% @salle = Salle.find(salle_id) %> 
        <% if bloc != @salle.nom[0] %><hr><% bloc = @salle.nom[0] %><% end %>

        <%= calendar partial: 'simple_calendar/week_rooms_calendar', 
                     events: @cours.where(salle_id:@salle.id), salle_id:@salle.id, 
                     number_of_days: 6 do |date, meetings| %>

          <% if user_signed_in? %>
            <%= link_to "+", new_cour_path(debut:date, salle_id:@salle.id, etat:2, from:'planning_salles'), class:"btn btn-default btn-sm" %>
            <br><br>
          <% end %>  

          <% meetings.each do |meeting| %>
            <!--- chercher si conflit de salle ! -->
            <% if Cour.where("cours.id <> ? AND salle_id = ? AND (((debut BETWEEN ? AND ?) OR (fin BETWEEN ? AND ?)) OR (debut < ? AND fin > ?))", 
                          meeting.id, salle_id, meeting.debut, meeting.fin, meeting.debut, meeting.fin, meeting.fin, meeting.debut)
                          .where.not(debut:meeting.fin)
                          .where.not(fin:meeting.debut)
                          .any? %>
              <span style="background-color:black;color:yellow;">BANZA√è !!!</span>
            <% end %>  

            <div style="height:<%= 30 + (20 * meeting.duree) %>px;border:1px;border-style:solid;border-color:lightgrey;">
              <b><%= l(meeting.debut, format: :heures_min) %></b>  
              - <%= l(meeting.fin, format: :heures_min) %>
              <br>

              <span style="background-color:<%= meeting.formation.color %>;padding-left: 7px;"></span>
              <span style="padding-left: 7px;"></span>

              <% if meeting.formation.abrg %>
                <%= link_to meeting.formation.abrg, edit_cour_path(meeting, from:'planning_salles'), title:meeting.nom %>
              <% else %>
                <%= link_to meeting.formation.nom, meeting %>
              <% end %>
              <br>
            </div>
          <% end %>

        <% end %>
      <% end %>
    </div>
</div>
